<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'">
    <title>Star Commander</title>
    <link rel="stylesheet" href="styles.css">
    <script src="i18n.js"></script>
</head>
<body>
    <!-- Custom Titlebar -->
    <div class="titlebar">
        <div class="titlebar-drag">
            <span class="titlebar-icon">‚≠ê</span>
            <span class="titlebar-title">Star Commander</span>
        </div>
        <div class="titlebar-controls">
            <button class="titlebar-btn" id="btn-minimize">‚îÄ</button>
            <button class="titlebar-btn btn-close" id="btn-close">‚úï</button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-indicator" id="status-indicator">
                <span class="status-dot"></span>
                <span class="status-text" data-i18n="status.stopped">Stopped</span>
            </div>
            <div class="status-actions">
                <span class="mode-title" id="mode-badge" data-i18n="modes.commander">üëë Commander</span>
                <button class="btn btn-primary" id="btn-start" data-i18n="buttons.start">‚ñ∂ Start</button>
            </div>
        </div>

        <!-- Main Panel: 2 columns -->
        <div class="main-panel">
            <!-- Left: Channel Selector -->
            <div class="channel-section">
                <h3>üìª <span id="active-channel" data-i18n="channels.mute">MUTE</span></h3>
                <div class="channel-grid" id="channel-grid">
                    <button class="channel-btn active" data-target="mute">
                        <span class="channel-name" data-i18n="channels.mute">MUTE</span>
                        <span class="channel-key">1</span>
                    </button>
                    <button class="channel-btn" data-target="all">
                        <span class="channel-name" data-i18n="channels.all">ALL</span>
                        <span class="channel-key">0</span>
                    </button>
                    <button class="channel-btn" data-target="channel1">
                        <span class="channel-name" id="channel1-name">Channel 1</span>
                        <span class="channel-key">2</span>
                    </button>
                    <button class="channel-btn" data-target="channel2">
                        <span class="channel-name" id="channel2-name">Channel 2</span>
                        <span class="channel-key">3</span>
                    </button>
                    <button class="channel-btn" data-target="channel3">
                        <span class="channel-name" id="channel3-name">Channel 3</span>
                        <span class="channel-key">4</span>
                    </button>
                    <!-- Briefing button in grid -->
                    <button class="channel-btn btn-briefing-grid" id="btn-briefing">
                        <span class="channel-name" data-i18n="channels.briefing">üì¢ Briefing</span>
                        <span class="channel-key">5</span>
                    </button>
                </div>
                <!-- Whisper button for Chiefs -->
                <button class="btn btn-whisper" id="btn-whisper" style="display: none;" data-i18n="channels.whisper">
                    üéôÔ∏è Whisper
                </button>
            </div>

            <!-- Right: Logs -->
            <div class="logs-section">
                <h3 data-i18n="logs.title">üìä Logs</h3>
                <div class="logs-container" id="logs-container">
                    <div class="log-entry log-info" data-i18n="logs.welcome">Welcome to Star Commander</div>
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs" id="tabs-container">
            <button class="tab-btn active" data-tab="status" data-i18n="tabs.status">Status</button>
            <button class="tab-btn" data-tab="bots" data-i18n="tabs.bots">Bots</button>
            <button class="tab-btn" data-tab="chiefs" data-i18n="tabs.chiefs">Chiefs</button>
            <button class="tab-btn" data-tab="keybinds" data-i18n="tabs.keybinds">Keybinds</button>
            <button class="tab-btn" data-tab="options" data-i18n="tabs.options">Options</button>
        </div>

        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Status Tab -->
            <div class="tab-pane active" id="tab-status">
                <!-- Commandant: Bot status grid -->
                <div class="bot-status-grid" id="bot-status-grid">
                    <div class="bot-status" id="emitter-status">
                        <span class="bot-dot"></span>
                        <span>Emitter</span>
                    </div>
                    <div class="bot-status" id="receiver1-status">
                        <span class="bot-dot"></span>
                        <span id="receiver1-name">Receiver 1</span>
                    </div>
                    <div class="bot-status" id="receiver2-status">
                        <span class="bot-dot"></span>
                        <span id="receiver2-name">Receiver 2</span>
                    </div>
                    <div class="bot-status" id="receiver3-status">
                        <span class="bot-dot"></span>
                        <span id="receiver3-name">Receiver 3</span>
                    </div>
                </div>
                
                <!-- Chief: Info section -->
                <div id="chief-status-info" style="display: none;">
                    <div class="chief-info-card">
                        <h4>üéôÔ∏è Mode Chef</h4>
                        <div class="chief-identity">
                            <span class="chief-identity-name" id="chief-identity-name">-</span>
                            <span class="chief-identity-channel">üì¢ <span id="chief-identity-channel">-</span></span>
                        </div>
                        <div class="chief-instructions">
                            <p><strong>Whisper (toggle) :</strong></p>
                            <ol>
                                <li>Rejoignez votre channel vocal</li>
                                <li>Cliquez sur Whisper pour l'activer</li>
                                <li>Parlez - votre voix est relay√©e au Commandant</li>
                                <li>Recliquez pour d√©sactiver</li>
                            </ol>
                            <p class="whisper-note">‚ö†Ô∏è Votre channel vous entend toujours ! Le Whisper ajoute le Commandant en plus.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bots Tab (Commandant only) -->
            <div class="tab-pane" id="tab-bots">
                <!-- Load Channels Button -->
                <button class="btn" id="btn-load-channels" style="display: none; margin-bottom: 15px;">
                    <span id="load-channels-text">üîÑ Load Discord Channels</span>
                </button>
                
                <div class="bot-config-section">
                    <h4 data-i18n="bots.emitter">üéß Emitter <span class="bot-desc" data-i18n="bots.emitter_desc">- listens to commanders</span></h4>
                    <div class="form-row">
                        <div class="form-group" style="flex: 2">
                            <label data-i18n="bots.token">Bot Token</label>
                            <input type="password" id="token-emitter" data-i18n-placeholder="bots.placeholders.token" placeholder="Bot token...">
                        </div>
                        <div class="form-group" style="flex: 1">
                            <label data-i18n="bots.sourceChannel">Source Channel ID</label>
                            <div style="position: relative;">
                                <input 
                                    type="text" 
                                    id="channel-source-search" 
                                    list="channels-list-source"
                                    placeholder="Search channel or paste ID"
                                    autocomplete="off"
                                    style="width: 100%;">
                                <datalist id="channels-list-source"></datalist>
                                <input type="hidden" id="channel-source">
                                <div id="selected-channel-source" class="selected-item" style="display: none;">
                                    Selected: <strong id="selected-channel-name-source"></strong> 
                                    (<code id="selected-channel-id-source"></code>)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bot-config-section">
                    <h4>üì¢ <span data-i18n="bots.receiver">Receiver</span> 1 <span class="bot-desc" data-i18n="bots.receiver_desc">- broadcasts to target</span></h4>
                    <div class="form-row">
                        <div class="form-group" style="flex: 1">
                            <label data-i18n="bots.displayName">Display Name</label>
                            <input type="text" id="name-receiver1" data-i18n-placeholder="bots.placeholders.displayName" placeholder="e.g. Artillery">
                        </div>
                        <div class="form-group" style="flex: 1">
                            <label data-i18n="bots.targetChannel">Target Channel ID</label>
                            <div style="position: relative;">
                                <input 
                                    type="text" 
                                    id="target1-search" 
                                    list="channels-list-1"
                                    placeholder="Search channel or paste ID"
                                    autocomplete="off"
                                    style="width: 100%;">
                                <datalist id="channels-list-1"></datalist>
                                <input type="hidden" id="target1-id">
                                <div id="selected-channel-1" class="selected-item" style="display: none;">
                                    Selected: <strong id="selected-channel-name-1"></strong> 
                                    (<code id="selected-channel-id-1"></code>)
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label data-i18n="bots.token">Bot Token</label>
                        <input type="password" id="token-receiver1" data-i18n-placeholder="bots.placeholders.token" placeholder="Bot token...">
                    </div>
                </div>

                <div class="bot-config-section">
                    <h4>üì¢ <span data-i18n="bots.receiver">Receiver</span> 2 <span class="bot-desc" data-i18n="bots.receiver_desc">- broadcasts to target</span></h4>
                    <div class="form-row">
                        <div class="form-group" style="flex: 1">
                            <label data-i18n="bots.displayName">Display Name</label>
                            <input type="text" id="name-receiver2" data-i18n-placeholder="bots.placeholders.displayName" placeholder="e.g. Engineers">
                        </div>
                        <div class="form-group" style="flex: 1">
                            <label data-i18n="bots.targetChannel">Target Channel ID</label>
                            <div style="position: relative;">
                                <input 
                                    type="text" 
                                    id="target2-search" 
                                    list="channels-list-2"
                                    placeholder="Search channel or paste ID"
                                    autocomplete="off"
                                    style="width: 100%;">
                                <datalist id="channels-list-2"></datalist>
                                <input type="hidden" id="target2-id">
                                <div id="selected-channel-2" class="selected-item" style="display: none;">
                                    Selected: <strong id="selected-channel-name-2"></strong> 
                                    (<code id="selected-channel-id-2"></code>)
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label data-i18n="bots.token">Bot Token</label>
                        <input type="password" id="token-receiver2" data-i18n-placeholder="bots.placeholders.token" placeholder="Bot token...">
                    </div>
                </div>

                <div class="bot-config-section">
                    <h4>üì¢ <span data-i18n="bots.receiver">Receiver</span> 3 <span class="bot-desc" data-i18n="bots.receiver_desc">- broadcasts to target</span></h4>
                    <div class="form-row">
                        <div class="form-group" style="flex: 1">
                            <label data-i18n="bots.displayName">Display Name</label>
                            <input type="text" id="name-receiver3" data-i18n-placeholder="bots.placeholders.displayName" placeholder="e.g. Squadron">
                        </div>
                        <div class="form-group" style="flex: 1">
                            <label data-i18n="bots.targetChannel">Target Channel ID</label>
                            <div style="position: relative;">
                                <input 
                                    type="text" 
                                    id="target3-search" 
                                    list="channels-list-3"
                                    placeholder="Search channel or paste ID"
                                    autocomplete="off"
                                    style="width: 100%;">
                                <datalist id="channels-list-3"></datalist>
                                <input type="hidden" id="target3-id">
                                <div id="selected-channel-3" class="selected-item" style="display: none;">
                                    Selected: <strong id="selected-channel-name-3"></strong> 
                                    (<code id="selected-channel-id-3"></code>)
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label data-i18n="bots.token">Bot Token</label>
                        <input type="password" id="token-receiver3" data-i18n-placeholder="bots.placeholders.token" placeholder="Bot token...">
                    </div>
                </div>

				<!-- Relay Channel for Whisper -->
				<div class="bot-config-section">
				    <h4 data-i18n="bots.whisperRelay">üì° Whisper Relay <span class="bot-desc" data-i18n="bots.whisperRelay_desc">- for chief ‚Üí commander communication</span></h4>
				    <div class="form-row">
				        <div class="form-group" style="flex: 1">
				            <label data-i18n="bots.channelIdText">Channel ID (text)</label>
				            <div style="position: relative;">
				                <input 
				                    type="text" 
				                    id="channel-relay-search" 
				                    list="channels-list-relay"
				                    placeholder="Search channel or paste ID"
				                    autocomplete="off"
				                    style="width: 100%;">
				                <datalist id="channels-list-relay"></datalist>
				                <input type="hidden" id="channel-relay">
				                <div id="selected-channel-relay" class="selected-item" style="display: none;">
				                    Selected: <strong id="selected-channel-name-relay"></strong> 
				                    (<code id="selected-channel-id-relay"></code>)
				                </div>
				            </div>
				        </div>
				        <div class="form-group" style="flex: 2">
				            <label><span data-i18n="bots.webhookUrl">Webhook URL</span> <a href="#" onclick="openExternal('https://support.discord.com/hc/en-us/articles/228383668-Intro-to-Webhooks'); return false;">(<span data-i18n="bots.webhookHelp">how to create?</span>)</a></label>
				            <input type="text" id="webhook-relay" data-i18n-placeholder="bots.placeholders.webhookUrl" placeholder="https://discord.com/api/webhooks/...">
				        </div>
				    </div>
				</div>

                <button class="btn btn-primary" id="btn-save-bots" data-i18n="bots.saveAll">Save All</button>
            </div>

            <!-- Chiefs Tab (Commandant: manage chiefs, Chef: view only) -->
            <div class="tab-pane" id="tab-chiefs">
                <p class="help-text" data-i18n="chiefs.description" data-i18n-html>Define chiefs and their assigned channel. Each chief can whisper to commanders.</p>
                <div id="chiefs-list"></div>
                <div id="chiefs-add-section" class="form-group">
				    <h4 data-i18n="chiefs.addChief">Add Chief</h4>
				    
				    <!-- Load Members Button (only shown when relay running) -->
				    <button class="btn" id="btn-load-members" style="margin-bottom: 10px; display: none;">
				        <span id="load-members-text">üîÑ Load Discord Members</span>
				    </button>
				    
				    <div class="form-row">
				        <!-- User autocomplete input with datalist -->
				        <div style="flex: 2; position: relative;">
				            <input 
				                type="text" 
				                id="new-chief-search" 
				                list="members-list"
				                data-i18n-placeholder="chiefs.placeholders.userId" 
				                placeholder="Search member by name or paste ID"
				                autocomplete="off">
				            <datalist id="members-list"></datalist>
				            <input type="hidden" id="new-chief-userid">
				            <div id="selected-member" style="display: none; margin-top: 5px; font-size: 11px; color: var(--text-secondary);">
				                Selected: <strong id="selected-member-name"></strong> (<code id="selected-member-id"></code>)
				            </div>
				        </div>
				        <input type="text" id="new-chief-name" data-i18n-placeholder="chiefs.placeholders.name" placeholder="Name (auto-filled)">
				        <select id="new-chief-channel">
				            <option value="" data-i18n="chiefs.selectChannel">-- Channel --</option>
				        </select>
				        <button class="btn btn-primary" id="btn-add-chief" data-i18n="chiefs.addChief">Add</button>
				    </div>
				</div>
            </div>

            <!-- Keybinds Tab -->
            <div class="tab-pane" id="tab-keybinds">
                <p class="help-text">Cliquez sur un champ et appuyez sur la touche souhait√©e.<br>
                üí° Combinaisons possibles : <strong>Ctrl+2</strong>, <strong>Alt+F1</strong>, <strong>Shift+num0</strong>, etc.</p>
                <div id="keybinds-commandant">
                    <div class="form-group">
                        <label>All Channels</label>
                        <input type="text" id="keybind-all" class="keybind-input" readonly placeholder="Press a key...">
                    </div>
                    <div class="form-group">
                        <label>Mute</label>
                        <input type="text" id="keybind-mute" class="keybind-input" readonly placeholder="Press a key...">
                    </div>
                    <div class="form-group">
                        <label id="keybind-channel1-label">Channel 1</label>
                        <input type="text" id="keybind-channel1" class="keybind-input" readonly placeholder="Press a key...">
                    </div>
                    <div class="form-group">
                        <label id="keybind-channel2-label">Channel 2</label>
                        <input type="text" id="keybind-channel2" class="keybind-input" readonly placeholder="Press a key...">
                    </div>
                    <div class="form-group">
                        <label id="keybind-channel3-label">Channel 3</label>
                        <input type="text" id="keybind-channel3" class="keybind-input" readonly placeholder="Press a key...">
                    </div>
                    <div class="form-group">
                        <label>üì¢ Briefing (rassemblement)</label>
                        <input type="text" id="keybind-briefing" class="keybind-input" readonly placeholder="Press a key...">
                    </div>
                </div>
                <div id="keybinds-chief" style="display: none;">
                    <div class="form-group">
                        <label>üé§ Whisper (parler au commandant)</label>
                        <input type="text" id="keybind-whisper" class="keybind-input" readonly placeholder="Press a key...">
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 15px;">
                    <button class="btn btn-primary" id="btn-save-keybinds">Save Keybinds</button>
                    <button class="btn" id="btn-reset-keybinds">üîÑ Reset par d√©faut</button>
                </div>
            </div>

            <!-- Options Tab -->
            <div class="tab-pane" id="tab-options">
                <!-- Buy Me a Coffee - Top Right -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="margin: 0;">‚öôÔ∏è Options</h3>
                    <a href="#" onclick="openExternal('https://buymeacoffee.com/niochenicoz'); return false;" 
                       class="btn-coffee" 
                       title="Support the developer">
                        <span class="coffee-icon">‚òï</span>
                        <span class="coffee-text">Buy me a coffee</span>
                    </a>
                </div>
                
                <!-- ... reste du code ... -->
                <h4 data-i18n="options.language">Language</h4>
                <div class="option-group">
                    <div class="option-item">
                        <div class="option-info">
                            <span class="option-label" data-i18n="options.language">Language</span>
                            <span class="option-desc" data-i18n="options.language_desc">Choose your interface language</span>
                        </div>
                        <select id="language-select" class="language-select">
                            <option value="en">English</option>
                            <option value="fr">Fran√ßais</option>
                            <option value="es">Espa√±ol</option>
                            <option value="pt">Portugu√™s</option>
                            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                            <option value="zh">‰∏≠Êñá</option>
                            <option value="ja">Êó•Êú¨Ë™û</option>
                            <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                        </select>
                    </div>
                </div>
                
                <h4 data-i18n="options.display">Display</h4>
                
                <div class="option-group">
                    <div class="option-item">
                        <div class="option-info">
                            <span class="option-label" data-i18n="options.overlay">üìå Overlay (show active channel)</span>
                            <span class="option-desc" data-i18n="options.overlay_desc">Displays a small always-visible window with the selected channel</span>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="option-overlay">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <h4 data-i18n="options.audio">üîä Audio Effects</h4>
                <p class="help-text" data-i18n="options.audio_desc">These effects apply only to relayed voices between channels.</p>
                
                <div class="option-group">
                    <div class="option-item">
                        <div class="option-info">
                            <span class="option-label" data-i18n="options.radioEffect">üìª Radio effect (walkie-talkie)</span>
                            <span class="option-desc" data-i18n="options.radioEffect_desc">Applies a radio filter on transmitted voices</span>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="option-radio-effect" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    
                    <div class="option-item" id="radio-intensity-row">
                        <div class="option-info">
                            <span class="option-label" data-i18n="options.intensity">üéöÔ∏è Effect intensity</span>
                            <span class="option-desc" data-i18n="options.intensity_desc">0% = light, 100% = strong</span>
                        </div>
                        <div class="slider-container">
                            <input type="range" id="option-radio-intensity" min="0" max="100" value="50" class="slider">
                            <span class="slider-value" id="radio-intensity-value">50%</span>
                        </div>
                    </div>
                    
                    <div class="option-item">
                        <div class="option-info">
                            <span class="option-label" data-i18n="options.clickSound">üîò Radio click sound</span>
                            <span class="option-desc" data-i18n="options.clickSound_desc">Plays a click at the start of each transmission</span>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="option-click-sound" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                
                <h4 data-i18n="options.theme">üé® Custom Theme</h4>
                <p class="help-text" data-i18n="options.theme_desc">Customize interface colors. Default theme is Star Citizen.</p>
                
                <div class="theme-grid">
                    <div class="theme-color-item">
                        <label data-i18n="options.bgPrimary">Primary background</label>
                        <input type="color" id="theme-bg-primary" value="#0c1621">
                    </div>
                    <div class="theme-color-item">
                        <label data-i18n="options.bgSecondary">Secondary background</label>
                        <input type="color" id="theme-bg-secondary" value="#14202e">
                    </div>
                    <div class="theme-color-item">
                        <label data-i18n="options.bgTertiary">Tertiary background</label>
                        <input type="color" id="theme-bg-tertiary" value="#1a2c3f">
                    </div>
                    <div class="theme-color-item">
                        <label data-i18n="options.accentPrimary">Primary accent</label>
                        <input type="color" id="theme-accent" value="#11a9ed">
                    </div>
                    <div class="theme-color-item">
                        <label data-i18n="options.accentHover">Hover accent</label>
                        <input type="color" id="theme-accent-hover" value="#2daee8">
                    </div>
                    <div class="theme-color-item">
                        <label data-i18n="options.textSecondary">Secondary text</label>
                        <input type="color" id="theme-text-secondary" value="#8ea8c3">
                    </div>
                    <div class="theme-color-item">
                        <label data-i18n="options.success">Success</label>
                        <input type="color" id="theme-success" value="#00d97e">
                    </div>
                    <div class="theme-color-item">
                        <label data-i18n="options.warning">Warning</label>
                        <input type="color" id="theme-warning" value="#f7b731">
                    </div>
                    <div class="theme-color-item">
                        <label data-i18n="options.error">Error</label>
                        <input type="color" id="theme-error" value="#ee5a6f">
                    </div>
                    <div class="theme-color-item">
                        <label data-i18n="options.borders">Borders</label>
                        <input type="color" id="theme-border" value="#1a4d6b">
                    </div>
                </div>
                
                <div style="display: flex; gap: 10px; margin-top: 15px; flex-wrap: wrap;">
                    <button class="btn" id="btn-reset-theme" data-i18n="options.resetTheme">üîÑ Reset Star Citizen</button>
                    <button class="btn" id="btn-export-theme" data-i18n="options.exportTheme">üì§ Export theme</button>
                    <button class="btn" id="btn-import-theme" data-i18n="options.importTheme">üì• Import theme</button>
                </div>
                
                <button class="btn btn-primary" id="btn-save-options" style="margin-top: 15px;" data-i18n="options.saveOptions">Save Options</button>
                
                <!-- Export/Import config (Commandant only) -->
                <div id="export-section" style="margin-top: 30px;">
                    <h4 data-i18n="options.configuration">üì¶ Configuration</h4>
                    <p class="help-text" data-i18n="options.config_desc">Export your configuration to share with your chiefs, or import an existing configuration.</p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn" id="btn-export-config" data-i18n="options.exportConfig">üì§ Export config</button>
                        <button class="btn" id="btn-import-config" data-i18n="options.importConfig">üì• Import config</button>
                    </div>
                </div>
                
                <!-- Reset complet -->
                <div style="margin-top: 40px; padding-top: 20px; border-top: 2px solid var(--border);">
                    <div style="background: rgba(238, 74, 111, 0.1); border-left: 4px solid var(--error); padding: 15px; border-radius: 6px; margin-bottom: 15px;">
                        <h4 style="margin: 0 0 8px 0; color: var(--error); font-size: 14px;" data-i18n="options.dangerZone">‚ö†Ô∏è Danger Zone</h4>
                        <p style="margin: 0; font-size: 12px; color: var(--text-secondary); line-height: 1.5;" data-i18n="options.resetWarning" data-i18n-html>
                            Complete reset deletes <strong>all configuration</strong>: bots, channels, chiefs, keybinds and settings.
                            <br>This action is <strong>irreversible</strong>. The configuration wizard will restart.
                        </p>
                    </div>
                    <button class="btn btn-danger" id="btn-reset-config" data-i18n="options.resetComplete">üóëÔ∏è Complete software reset</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Setup Wizard -->
    <div class="wizard-overlay" id="wizard-overlay" style="display: none;">
        <div class="wizard">
            <h2 data-i18n="wizard.welcome">‚≠ê Welcome to Star Commander</h2>
            
            <!-- Language selector in wizard -->
            <div style="text-align: right; margin-bottom: 15px;">
                <select id="wizard-language-select" class="language-select" style="min-width: 120px;">
                    <option value="en">English</option>
                    <option value="fr">Fran√ßais</option>
                    <option value="es">Espa√±ol</option>
                    <option value="pt">Portugu√™s</option>
                    <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                    <option value="zh">‰∏≠Êñá</option>
                    <option value="ja">Êó•Êú¨Ë™û</option>
                    <option value="ar">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</option>
                </select>
            </div>
            
            <!-- Step 0: Choose Mode -->
            <div class="wizard-step" id="wizard-step-0">
                <h3 data-i18n="wizard.chooseRole">Choose your role</h3>
                <p data-i18n="wizard.roleQuestion">How will you use Star Commander?</p>
                
                <div class="mode-selection">
                    <button class="mode-card" id="btn-mode-commandant">
                        <span class="mode-icon">üëë</span>
                        <span class="mode-title" data-i18n="wizard.commander">COMMANDER</span>
                        <span class="mode-desc" data-i18n="wizard.commander_desc">I configure the bots and manage the fleet</span>
                    </button>
                    <button class="mode-card" id="btn-mode-chief">
                        <span class="mode-icon">üéñÔ∏è</span>
                        <span class="mode-title" data-i18n="wizard.chief">CHIEF</span>
                        <span class="mode-desc" data-i18n="wizard.chief_desc">I import the commander's configuration</span>
                    </button>
                </div>
            </div>

            <!-- COMMANDANT FLOW -->
            <!-- Step 0: Existing config? -->
            <div class="wizard-step" id="wizard-step-cmd-0" style="display: none;">
                <h3 data-i18n="wizard.existingConfig">Do you have an existing configuration?</h3>
                <p data-i18n="wizard.existingConfig_question">Do you already have a Star Commander configuration to restore?</p>
                
                <div class="mode-selection">
                    <button class="mode-card" id="btn-cmd-import">
                        <span class="mode-icon">üì•</span>
                        <span class="mode-title" data-i18n="wizard.yes">YES</span>
                        <span class="mode-desc" data-i18n="wizard.yesConfig_desc">I have a config.json file</span>
                    </button>
                    <button class="mode-card" id="btn-cmd-new">
                        <span class="mode-icon">‚ûï</span>
                        <span class="mode-title" data-i18n="wizard.no">NO</span>
                        <span class="mode-desc" data-i18n="wizard.newConfig_desc">New configuration</span>
                    </button>
                </div>
                
                <button class="btn" onclick="wizardStep(0)" data-i18n="wizard.back">‚Üê Back</button>
            </div>
            
            <!-- Step 0b: Import for Commandant -->
            <div class="wizard-step" id="wizard-step-cmd-import" style="display: none;">
                <h3 data-i18n="wizard.importConfiguration">Import Configuration</h3>
                <p data-i18n="wizard.selectFile" data-i18n-html>Select your <strong>starcommander-config.json</strong> file</p>
                
                <div class="import-zone" id="import-zone-cmd">
                    <span class="import-icon">üìÅ</span>
                    <span class="import-text" data-i18n="wizard.clickToSelect">Click to select file</span>
                    <input type="file" id="import-file-cmd" accept=".json" style="display: none;">
                </div>
                
                <div id="import-preview-cmd" style="display: none;">
                    <p class="wizard-note success" data-i18n="wizard.configLoaded">‚úÖ Config loaded!</p>
                    <div class="import-info">
                        <p><strong data-i18n="wizard.channelsFound">Channels found:</strong></p>
                        <ul id="import-channels-list-cmd"></ul>
                    </div>
                </div>
                
                <button class="btn" onclick="wizardStep('cmd-0')" data-i18n="wizard.back">‚Üê Back</button>
                <button class="btn btn-primary" id="btn-cmd-import-finish" onclick="wizardFinishCommandantImport()" disabled data-i18n="wizard.finish">Finish ‚úì</button>
            </div>

            <!-- Step 1: Create Bots -->
            <div class="wizard-step" id="wizard-step-cmd-1" style="display: none;">
                <h3 data-i18n="wizard.step1_title">Step 1: Create Discord Bots</h3>
                <p data-i18n="wizard.step1_intro" data-i18n-html>You need to create <strong>4 Discord bots</strong>:</p>
                <ul>
                    <li data-i18n="wizard.step1_emitter" data-i18n-html><strong>1 Emitter</strong> - listens to commanders channel</li>
                    <li data-i18n="wizard.step1_receivers" data-i18n-html><strong>3 Receivers</strong> - speak in target channels</li>
                </ul>
                
                <div class="wizard-instructions">
                    <h4 data-i18n="wizard.step1_instructions">üìù For each bot:</h4>
                    <ol>
                        <li data-i18n="wizard.step1_instr1">Go to Discord Developer Portal</li>
                        <li data-i18n="wizard.step1_instr2" data-i18n-html>Click <strong>"New Application"</strong> ‚Üí Name it</li>
                        <li data-i18n="wizard.step1_instr3" data-i18n-html><strong>"Bot"</strong> tab ‚Üí <strong>"Reset Token"</strong> ‚Üí Copy</li>
                        <li data-i18n="wizard.step1_instr4" data-i18n-html>Enable <strong>Privileged Gateway Intents</strong>:
                            <ul>
                                <li data-i18n="wizard.step1_instr4_1">‚úÖ Presence Intent</li>
                                <li data-i18n="wizard.step1_instr4_2" data-i18n-html>‚úÖ Server Members Intent <span class="required">(required!)</span></li>
                                <li data-i18n="wizard.step1_instr4_3">‚úÖ Message Content Intent</li>
                            </ul>
                        </li>
                        <li data-i18n="wizard.step1_instr5" data-i18n-html><strong>"OAuth2" ‚Üí "URL Generator"</strong></li>
                        <li data-i18n="wizard.step1_instr6" data-i18n-html>Scopes: <strong>bot</strong> | Permissions: <strong>Connect, Speak</strong></li>
                        <li data-i18n="wizard.step1_instr7">Invite the bot to your server</li>
                    </ol>
                </div>
                
                <p class="wizard-note" data-i18n="wizard.step1_note">‚ö†Ô∏è Repeat for all 4 bots, then click Next</p>
                <button class="btn" onclick="wizardStep('cmd-0')" data-i18n="wizard.back">‚Üê Back</button>
                <button class="btn btn-primary" onclick="wizardStep('cmd-2')" data-i18n="wizard.next">Next ‚Üí</button>
            </div>
            
            <!-- Step 2: Tokens -->
            <div class="wizard-step" id="wizard-step-cmd-2" style="display: none;">
                <h3 data-i18n="wizard.step2_title">Step 2: Bot Tokens</h3>
                <div class="form-group">
                    <label data-i18n="wizard.emitterToken">Emitter Token</label>
                    <input type="password" id="wizard-token-emitter" data-i18n-placeholder="wizard.pasteToken" placeholder="Paste the token...">
                </div>
                <div class="form-group">
                    <label data-i18n="wizard.receiver1Token">Receiver 1 Token</label>
                    <input type="password" id="wizard-token-receiver1" data-i18n-placeholder="wizard.pasteToken" placeholder="Paste the token...">
                </div>
                <div class="form-group">
                    <label data-i18n="wizard.receiver2Token">Receiver 2 Token</label>
                    <input type="password" id="wizard-token-receiver2" data-i18n-placeholder="wizard.pasteToken" placeholder="Paste the token...">
                </div>
                <div class="form-group">
                    <label data-i18n="wizard.receiver3Token">Receiver 3 Token</label>
                    <input type="password" id="wizard-token-receiver3" data-i18n-placeholder="wizard.pasteToken" placeholder="Paste the token...">
                </div>
                <p class="wizard-note" data-i18n="wizard.tokensLocal">üîí Tokens are stored locally only</p>
                <button class="btn" onclick="wizardStep('cmd-1')" data-i18n="wizard.back">‚Üê Back</button>
                <button class="btn btn-primary" onclick="wizardValidateStep2()" data-i18n="wizard.next">Next ‚Üí</button>
            </div>
            
			<!-- Step 3: Channels -->
			<div class="wizard-step" id="wizard-step-cmd-3" style="display: none;">
			    <h3 data-i18n="wizard.step3_title">Step 3: Configure Voice Channels</h3>
			    
			    <!-- Load Channels Button -->
			    <button class="btn" id="wizard-btn-load-channels" style="margin-bottom: 15px;">
			        <span id="wizard-load-channels-text">üîÑ Load Discord Channels</span>
			    </button>
			    
			    <p class="wizard-note" data-i18n="wizard.step3_note">üí° Load channels above or paste IDs manually</p>
			    
			    <div class="form-group">
			        <label data-i18n="wizard.sourceChannel">Source Channel (Commanders) - voice</label>
			        <div style="position: relative;">
			            <input 
			                type="text" 
			                id="wizard-channel-source-search" 
			                list="wizard-channels-list-source"
			                placeholder="Search channel or paste ID"
			                autocomplete="off"
			                style="width: 100%;">
			            <datalist id="wizard-channels-list-source"></datalist>
			            <input type="hidden" id="wizard-channel-source">
			            <div id="wizard-selected-channel-source" class="selected-item" style="display: none;">
			                Selected: <strong id="wizard-selected-channel-name-source"></strong> 
			                (<code id="wizard-selected-channel-id-source"></code>)
			            </div>
			        </div>
			    </div>
			    
			    <hr>
			    
			    <div class="form-row">
			        <div class="form-group">
			            <label data-i18n="wizard.target1_name">Target 1 - Name</label>
			            <input type="text" id="wizard-target1-name" data-i18n-placeholder="wizard.exampleArtillery" placeholder="e.g. Artillery">
			        </div>
			        <div class="form-group">
			            <label data-i18n="wizard.channelID_voice">Channel ID (voice)</label>
			            <div style="position: relative;">
			                <input 
			                    type="text" 
			                    id="wizard-target1-search" 
			                    list="wizard-channels-list-1"
			                    placeholder="Search or paste ID"
			                    autocomplete="off"
			                    style="width: 100%;">
			                <datalist id="wizard-channels-list-1"></datalist>
			                <input type="hidden" id="wizard-target1-id">
			                <div id="wizard-selected-channel-1" class="selected-item" style="display: none;">
			                    <strong id="wizard-selected-channel-name-1"></strong> 
			                    (<code id="wizard-selected-channel-id-1"></code>)
			                </div>
			            </div>
			        </div>
			    </div>
			    
			    <div class="form-row">
			        <div class="form-group">
			            <label data-i18n="wizard.target2_name">Target 2 - Name</label>
			            <input type="text" id="wizard-target2-name" data-i18n-placeholder="wizard.exampleEngineers" placeholder="e.g. Engineers">
			        </div>
			        <div class="form-group">
			            <label data-i18n="wizard.channelID_voice">Channel ID (voice)</label>
			            <div style="position: relative;">
			                <input 
			                    type="text" 
			                    id="wizard-target2-search" 
			                    list="wizard-channels-list-2"
			                    placeholder="Search or paste ID"
			                    autocomplete="off"
			                    style="width: 100%;">
			                <datalist id="wizard-channels-list-2"></datalist>
			                <input type="hidden" id="wizard-target2-id">
			                <div id="wizard-selected-channel-2" class="selected-item" style="display: none;">
			                    <strong id="wizard-selected-channel-name-2"></strong> 
			                    (<code id="wizard-selected-channel-id-2"></code>)
			                </div>
			            </div>
			        </div>
			    </div>
			    
			    <div class="form-row">
			        <div class="form-group">
			            <label data-i18n="wizard.target3_name">Target 3 - Name</label>
			            <input type="text" id="wizard-target3-name" data-i18n-placeholder="wizard.examplePilots" placeholder="e.g. Pilots">
			        </div>
			        <div class="form-group">
			            <label data-i18n="wizard.channelID_voice">Channel ID (voice)</label>
			            <div style="position: relative;">
			                <input 
			                    type="text" 
			                    id="wizard-target3-search" 
			                    list="wizard-channels-list-3"
			                    placeholder="Search or paste ID"
			                    autocomplete="off"
			                    style="width: 100%;">
			                <datalist id="wizard-channels-list-3"></datalist>
			                <input type="hidden" id="wizard-target3-id">
			                <div id="wizard-selected-channel-3" class="selected-item" style="display: none;">
			                    <strong id="wizard-selected-channel-name-3"></strong> 
			                    (<code id="wizard-selected-channel-id-3"></code>)
			                </div>
			            </div>
			        </div>
			    </div>
			    
			    <button class="btn" onclick="wizardStep('cmd-2')" data-i18n="wizard.back">‚Üê Back</button>
			    <button class="btn btn-primary" onclick="wizardValidateStep3()" data-i18n="wizard.next">Next ‚Üí</button>
			</div>
            
			<!-- Step 4: Whisper Relay -->
			<div class="wizard-step" id="wizard-step-cmd-4" style="display: none;">
			    <h3 data-i18n="wizard.step4_title">Step 4: Configure Whisper Relay</h3>
			    <p data-i18n="wizard.step4_intro">Whisper allows chiefs to speak directly to the commander.</p>
			    
			    <div class="wizard-instructions">
			        <h4 data-i18n="wizard.step4_relay_title">üì° Create the relay channel:</h4>
			        <ol>
			            <li data-i18n="wizard.step4_relay_instr1" data-i18n-html>Create a <strong>private TEXT channel</strong> (e.g. "star-commander-relay")</li>
			            <li data-i18n="wizard.step4_relay_instr2" data-i18n-html>In channel permissions, <strong>add your 4 bots</strong>:
			                <ul>
			                    <li data-i18n="wizard.step4_relay_perm1">‚úÖ View Channel</li>
			                    <li data-i18n="wizard.step4_relay_perm2">‚úÖ Read Message History</li>
			                    <li data-i18n="wizard.step4_relay_perm3">‚úÖ Send Messages</li>
			                    <li data-i18n="wizard.step4_relay_perm4">‚úÖ Manage Messages (to delete commands)</li>
			                </ul>
			            </li>
			            <li data-i18n="wizard.step4_relay_instr3" data-i18n-html>Right-click on the channel ‚Üí <strong>"Copy ID"</strong></li>
			        </ol>
			    </div>
			    
			    <div class="form-group">
			        <label data-i18n="wizard.relayChannelID">üì° Relay Channel ID (text)</label>
			        <div style="position: relative;">
			            <input 
			                type="text" 
			                id="wizard-channel-relay-search" 
			                list="wizard-channels-list-relay"
			                placeholder="Search text channel or paste ID"
			                autocomplete="off"
			                style="width: 100%;">
			            <datalist id="wizard-channels-list-relay"></datalist>
			            <input type="hidden" id="wizard-channel-relay">
			            <div id="wizard-selected-channel-relay" class="selected-item" style="display: none;">
			                Selected: <strong id="wizard-selected-channel-name-relay"></strong> 
			                (<code id="wizard-selected-channel-id-relay"></code>)
			            </div>
			        </div>
			    </div>
			    
			    <div class="wizard-instructions" style="margin-top: 15px;">
			        <h4 data-i18n="wizard.step4_webhook_title">üîó Create the Webhook:</h4>
			        <ol>
			            <li data-i18n="wizard.step4_webhook_instr1" data-i18n-html><strong>Server Settings</strong> (click on server name)</li>
			            <li data-i18n="wizard.step4_webhook_instr2" data-i18n-html><strong>"Integrations"</strong> tab</li>
			            <li data-i18n="wizard.step4_webhook_instr3" data-i18n-html>Click <strong>"Webhooks"</strong> ‚Üí <strong>"New Webhook"</strong></li>
			            <li data-i18n="wizard.step4_webhook_instr4" data-i18n-html>Select the <strong>relay channel</strong> created previously</li>
			            <li data-i18n="wizard.step4_webhook_instr5" data-i18n-html>Click <strong>"Copy Webhook URL"</strong></li>
			        </ol>
			    </div>
			    
			    <div class="form-group">
			        <label data-i18n="wizard.webhookURL">üîó Webhook URL</label>
			        <input type="text" id="wizard-webhook-relay" placeholder="https://discord.com/api/webhooks/...">
			    </div>
			    
			    <p class="wizard-note" data-i18n="wizard.step4_note">‚ö†Ô∏è Without this configuration, Whisper won't work!</p>
			    
			    <button class="btn" onclick="wizardStep('cmd-3')" data-i18n="wizard.back">‚Üê Back</button>
			    <button class="btn btn-primary" onclick="wizardValidateStep4()" data-i18n="wizard.finish">Finish ‚úì</button>
			</div>

            <!-- CHIEF FLOW -->
            <!-- Step 1: Import Config -->
            <div class="wizard-step" id="wizard-step-chief-1" style="display: none;">
                <h3 data-i18n="wizard.chief_step1_title">Step 1: Import Configuration</h3>
                <p data-i18n="wizard.chief_step1_intro" data-i18n-html>Ask your commander for the <strong>starcommander-config.json</strong> file.</p>
                
                <div class="import-zone" id="import-zone">
                    <span class="import-icon">üìÅ</span>
                    <span class="import-text" data-i18n="wizard.clickToSelect">Click to select file</span>
                    <input type="file" id="import-file" accept=".json" style="display: none;">
                </div>
                
                <div id="import-preview" style="display: none;">
                    <p class="wizard-note success" data-i18n="wizard.configLoaded">‚úÖ Config loaded!</p>
                    <div class="import-info">
                        <p><strong data-i18n="wizard.channelsAvailable">Available channels:</strong></p>
                        <ul id="import-channels-list"></ul>
                    </div>
                </div>
                
                <button class="btn" onclick="wizardStep(0)" data-i18n="wizard.back">‚Üê Back</button>
                <button class="btn btn-primary" id="btn-chief-next" onclick="wizardStep('chief-2')" disabled data-i18n="wizard.next">Next ‚Üí</button>
            </div>
            
            <!-- Step 2: Select Identity -->
            <div class="wizard-step" id="wizard-step-chief-2" style="display: none;">
                <h3 data-i18n="wizard.chief_step2_title">Step 2: Identify Yourself</h3>
                <p data-i18n="wizard.chief_step2_intro">Select your role among configured chiefs:</p>
                
                <div class="form-group">
                    <label data-i18n="wizard.youAre">You are...</label>
                    <select id="wizard-chief-select" class="chief-select">
                        <option value="" data-i18n="wizard.selectOption">-- Select --</option>
                    </select>
                </div>
                
                <div id="chief-info" style="display: none;">
                    <p class="wizard-note"><span data-i18n="wizard.youWillBeIn">üì¢ You will be in channel</span> <strong id="chief-channel-name"></strong></p>
                    <p class="wizard-note" data-i18n="wizard.useWhisper">üé§ Use Whisper to speak to the commander</p>
                </div>
                
                <button class="btn" onclick="wizardStep('chief-1')" data-i18n="wizard.back">‚Üê Back</button>
                <button class="btn btn-primary" id="btn-chief-finish" onclick="wizardFinishChief()" disabled data-i18n="wizard.finish">Finish ‚úì</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>

